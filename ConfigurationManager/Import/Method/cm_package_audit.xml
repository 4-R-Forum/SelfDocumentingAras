<AML>
 <Item type="Method" id="D58E7A4D4D8440498C0FF5DEE41D8A8E" action="add">
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA[
var win =top.aras.uiFindWindowEx(document.thisItem.getID());
var selTabId = win.relationships.relTabbar.GetSelectedTab();
var grid = win.relationships.iframesCollection[selTabId].contentWindow.gridApplet;
var tabbar = win.relationships.relTabbar ;
// get selected Items
var selected_ids=grid.getSelectedItemIds();
if (selected_ids.length <1)
{
    top.aras.AlertError("Select one or more elements to select packages for audit");
    return;
}
// build a comma separated list of package names
var package_names="";
for (var i=0;i<selected_ids.length;i++)
{
    var this_package=grid.cells(selected_ids[i],grid.getColumnIndex("package_definition_D")).getValue(); //add _D to column_name!
    if (package_names.indexOf(this_package) === -1)
    {
        if(package_names!=="") {package_names += ",";}
        package_names += this_package;
    }
}
// call the package_audit report
var innov=document.thisItem.getInnovator();
var par=innov.getItemByKeyedName("Report","PackageAudit");
var ss=par.getProperty("xsl_stylesheet");
//var ss_url=top.aras.getServerBaseURL();
//ss_url=ss_url.replace("Server/","Client/customer/package_audit_report.xsl")

var qry1=innov.newItem("Method");
qry1.setProperty("package_names",package_names);
var res1=qry1.apply("package_audit_server2");
if (res1.isError()) { top.aras.AlertError(res1.getErrorString());return;}
var res2=res1.applyStylesheet(ss,"text");
var wnd=top.open("about:blank", "_blank", "toolbar=yes, scrollbars=yes, resizable=yes");
wnd.document.write(res2);

]]></method_code>
  <method_type>JavaScript</method_type>
  <name>cm_package_audit</name>
 </Item>
</AML>