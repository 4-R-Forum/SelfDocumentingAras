<AML>
 <Item type="Method" id="946C7CD86DCE4F60AC98257F1C5EE4D2" action="add">
  <execution_allowed_to keyed_name="World" type="Identity">A73B655731924CD0B027E4F4D5FCC0A9</execution_allowed_to>
  <method_code><![CDATA[debugger;
var innov=document.thisItem.getInnovator();
var qry1=document.thisItem.newItem(document.thisItem.getType());
qry1.setID(document.thisItem.getID());
qry1.setProperty("name",document.thisItem.getProperty("name"));
var this_file =qry1.apply("cm_export_selected_2");
if (this_file.isError()) {top.aras.AlertError(this_file.getErrorString); return; }
// var qry2=this.newItem("Document File");
// qry2.setProperty("source_id",res.getID());
// var res2=qry2.apply("get");
// var file_id=res2.getProperty("related_id");

// var this_file = innov.getItemById("File", file_id);

	with (aras) { 
		var filename = this_file.getProperty('filename');
		var item = this_file.node;
		var fileURL = getFileURLEx(item);
		if (fileURL === '') {
			aras.AlertError(aras.getResource('', 'item_methods_ex.failed_download_file_url_empty'));
			return false;
		}

		vault.clearClientData();
		vault.clearFileList();

		vault.setClientData('SOAPACTION', 'GetFile');
		vault.setClientData('DATABASE', aras.getDatabase());
		vault.setClientData('AUTHUSER', aras.getLoginName());
		vault.setClientData('AUTHPASSWORD', aras.getPassword());

		vault.setLocalFileName(filename);
		if (!vault.downloadFile(fileURL)) {
			aras.AlertError(aras.getResource('', 'file_management.failed_download_file'), 'item_window: ' + vault.getLastError(), aras.getResource('', 'common.client_side_err'));
		} else {
			aras.AlertSuccess(aras.getResource('', 'file_management.file_succesfully_downloaded', filename, "Downloads"));
		}
	}

	return true;
]]></method_code>
  <method_type>JavaScript</method_type>
  <name>cm_export_selected_client</name>
 </Item>
</AML>